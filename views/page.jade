extends layout

include mixins/form

block tools
  mixin tools('show', page.base.name)

block content

  #content.show
    span(style="float:right")
      |#{age}
      |&nbsp;|&nbsp;
      a(href="/meta/#{page.base.xid}") history
      |&nbsp;|&nbsp;
      a(href="/viki/#{title}") latest
    h1 #{title}

    !=content

  p.footer Updated by&nbsp;
    if commit.email
      img(src=gravatar().url("#{commit.email}", {s:16}))
    b  #{commit.author}
    |,&nbsp;
    | #{commit.timestamp} &ndash; #{page.base.xlink}

  #content.discuss

    h2 Discussion

    if comments
      each comment in comments
        if comment.comment.email
          img(src=gravatar().url("#{comment.comment.authorEmail}", {s:20}))
          | &nbsp;
        a(href="#{comment.comment.authorLink}") #{comment.comment.authorName}
        | &nbsp; &ndash; 
        a(href="/v/#{comment.markdown.plink}") #{comment.base.timestamp} 
        | (#{comment.comment.age})

        .well.well-sm
          !=comment.as.html

    h3 Add Comment

    a(id="addComment")
    form(action='#{commentLink}', method='post', class='edit')
      .form-group
        textarea.form-control(name="comment", data-widearea="enable", rows=2)#editor

      mixin saveAndCancel()

  #content.vote

    h2 Votes

    if votes
      each vote in votes
        if vote.vote.email
          img(src=gravatar().url("#{vote.vote.authorEmail}", {s:20}))
          | &nbsp;
        a(href="#{vote.vote.authorLink}") #{vote.vote.authorName}
        | &nbsp; &ndash; 
        a(href="/v/#{vote.base.timestamp}") #{vote.base.timestamp} 
        | (#{vote.vote.age})

        .well.well-sm
          p tbd

    h3 Vote

    a(id="addVote")
    form(action='#{voteLink}', method='post', class='edit')
      .well
        input(type='submit',name='vote',value=approveText || 'Approve').btn.btn-primary
        |&nbsp;
        input(type='submit',name='vote',value=rejectText || 'Reject').btn
        |&nbsp;
        input(type='submit',name='vote',value=abstainText || 'Abstain').btn
      span (comment optional)
      .form-group
        textarea.form-control(name="comment", data-widearea="enable", rows=2)#editor
